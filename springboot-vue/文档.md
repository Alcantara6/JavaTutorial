#### 前端history模式和后端登录拦截器

> 接下来，我们把前端打包后部署在后端。这不是前后端分离项目推荐的做法，之前我们讲过其实应该把前后端分别部署在不同的服务器中，但实际上仍有不少项目会选择把前后端整合在一起，只使用一个服务器，所以这里我们也提及一下这种方式，但在之后的开发中不会这样部署。
> 这时在项目的 dist 文件夹下生成了 static 文件夹和 index.html 文件，把这两个文件，拷贝到我们后端项目的 wj\src\main\resources\static 文件夹下，一定要注意这个位置，这时后端配置的静态文件的 path，虽然看起来很诡异，但一般都不作修改。
> 接下来，打开后端项目并运行，访问 http://localhost:8443/index.html ，（注意输入后缀 .html）发现页面是空白的，但确实取到了这个页面，再访问 http://localhost:8443/login ,发现跳转到了错误页面（White Error Page）。
> 这里我们回顾一下单页面应用的概念，在我们这个项目中，其实只有 index.html 这一个页面，所有的其它内容都是在这个页面里动态渲染的。当我们直接在后端访问 /login 路径时，服务器会后端并没有这个路径对应的内容，所以返回了 Error Page。
> 在后端项目中新建一个 package 名为 error，新建实现 ErrorPageRegistrar 接口的类 ErrorConfig，把默认的错误页面设置为 /index.html

#### Springboot启动自动执行sql

#### html escape

####  @JsonIgnoreProperties({"handler", "hibernateLazyInitializer"})

####  ErrorPageRegistrar

前后端不分离 方式在代码里用ErrorPageRegistrar配置404页面，前后端分离部署方式配置nginx转发到index页

#### 启动执行数据库
spring.sql.init...

#### sql设置级联关系
```sql
    CONSTRAINT `fk_book_category_on_cid` FOREIGN KEY (`cid`) REFERENCES `category` (`id`) ON DELETE SET NULL ON UPDATE CASCADE

```

#### Order

```java
public class OrderDemo {
    
    public void test() {
        Sort sort = Sort.by(Sort.Direction.DESC, "id");
    }
}
```

####  setup与props

* 不能v-model绑定一个父组件传来的prop，不能在子组件改变prop
* 不能定义一个变量：ref(props.value)，经试验不具有响应式。 
* 基于以上两点，用v-bind单向绑定
* `defineProps` 和 `defineEmits`的使用

#### toRaw

```typescript
const onSubmit = () => {
	validate().then(() => {
		const book: BookForm = toRaw(modelRef);
		emit('onSubmit', book);
	});
};
```

#### ref和reactive

```typescript
// 因为会修改所有属性，所以用ref不用reactive，免得挨个挨个更新属性值
function createModelRef(book: Book) {
	let modelRef = ref<Book>({
		id: null,
		title: '',
		author: '',
		category: {
			id: null,
			name: '',
		},
	});
	if (book != null) {
		modelRef = ref<Book>({ ...book });
	}
	return modelRef;
}
```

#### watch props

```typescript
export function useBooks(props: BookListProps) {
	const books: Ref<Book[]> = ref([]);

	watch(
		() => props.category,
		async (categoryId: number) => {
			if (categoryId > 0) {
				books.value = await listByCategory(categoryId);
			} else {
				books.value = await loadBooks();
			}
		},
	);

	return {
		books,
	};
}
```

####  后端分页

分页、搜索、分类查看简化交互，切换页码和分类查看都重置关键词为空并重新发起搜索。

#### 文件操作

`FileUtil.java` 

#### 图片上传

`UploadImage.java` 

`ImageUploader.vue` 组件

####  静态资源映射

`addResourceHandler` 、`addResourceLocations` 配置静态资源映射，注意`addResourceLocations` 的路径末尾必须有/

#### nginx部署

* `npm run build`打包文件放在 /var/www/html(nginx默认html路径)
* `gradlew bootJar`打包运行jar包
* 接口地址：`nginx`中运行相当于production环境，`axios.defaults.BaseURL`需要根据环境设定
* History模式，需要nginx服务器配置转发
* 要配置跨域

####  配置跨域

`addCorsMappings`

####  RBAC

Role-Based-Access-Control，用户角色权限管理模块设计

权限的三种粒度：**菜单权限、操作/功能权限、数据权限**
